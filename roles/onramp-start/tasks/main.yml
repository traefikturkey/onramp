---

- name: Make sure that the /apps directory exists.
  ansible.builtin.stat:
    path: /apps
  register: apps_dir

- name: Fail immediately if the target directory doesn't exist.
  ansible.builtin.fail:
    msg: "The /apps directory does not exist!"
  when: not apps_dir.stat.exist

- name: Copy enabled services to the remote host.
  ansible.builtin.copy:
    src: "services/{{ item }}"
    dest: "/apps/{{ service }}/docker-compose.yml"
    owner: "{{ PUID }}"
    group: "{{ PGID }}"
    mode: '0755'
  loop: "{{ services-enabled }}"
  register: 

- name: Start all Docker containers.
  ansible.builtin.shell: >
    cd /apps/{{ item }}
    docker compose up -d
  loop: "{{ services-enabled }}"
