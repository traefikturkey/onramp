# description: Provides file and print services for windows clients
# https://github.com/ServerContainers/samba
# NOTE: Migrated from dperson/samba (outdated) - env vars changed!
# See: https://github.com/ServerContainers/samba#environment-variables-and-à®Ÿdocker-secrets

services:
  samba:
    image: ghcr.io/servercontainers/samba:${SAMBA_DOCKER_TAG:-latest}
    env_file:
      - ./services-enabled/samba.env
    container_name: ${SAMBA_CONTAINER_NAME:-samba}
    restart: unless-stopped
    network_mode: host
    environment:
      - TZ=${TZ}
      # User accounts: ACCOUNT_<username>=<password>
      - ACCOUNT_${SAMBA_USER:-${USER}}=${SAMBA_PASSWORD}
      - UID_${SAMBA_USER:-${USER}}=${PUID:-1000}
      - GROUP_${SAMBA_USER:-${USER}}=${PGID:-1000}
      # Global config
      - SAMBA_CONF_WORKGROUP=${SAMBA_WORKGROUP:-workgroup}
      # Share config: [ShareName]; path=/path; options...
      - SAMBA_VOLUME_CONFIG_${SAMBA_SHARE1_NAME:-media}=[${SAMBA_SHARE1_NAME:-media}]; path=/${SAMBA_SHARE1_NAME:-media}; writable=yes; guest ok=no; valid users=${SAMBA_USER:-${USER}}; browseable=yes
      # Optional: disable avahi/wsdd2 if not needed
      #- AVAHI_DISABLE=1
      #- WSDD2_DISABLE=1
    volumes:
      - ${SAMBA_SHARE1_VOLUME:-./media}:/${SAMBA_SHARE1_NAME:-media}
      - /etc/localtime:/etc/localtime:ro
    labels:
      - traefik.enable=false
