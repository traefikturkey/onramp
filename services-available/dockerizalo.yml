networks:
  traefik:
    external: true

# description: Docker build and deployment platform 
# https://github.com/undernightcore/dockerizalo
# database: postgres
# database_name: dockerizalo

services:
  dockerizalo:
    image: ghcr.io/undernightcore/dockerizalo-proxy:latest
    container_name: ${DOCKERIZALO_PROXY_CONTAINER_NAME:-dockerizalo}
    networks:
      - traefik
    depends_on:
      - api
      - ui
    labels:
      - joyride.host.name=${DOCKERIZALO_PROXY_CONTAINER_NAME:-dockerizalo}.${HOST_DOMAIN}
      - traefik.enable=${DOCKERIZALO_PROXY_TRAEFIK_ENABLED:-true}
      - traefik.docker.network=traefik
      - traefik.http.routers.dockerizalo.entrypoints=websecure
      - traefik.http.routers.dockerizalo.rule=Host(`${DOCKERIZALO_PROXY_CONTAINER_NAME:-dockerizalo}.${HOST_DOMAIN}`)
      - traefik.http.services.dockerizalo.loadbalancer.server.port=8080
      - com.centurylinklabs.watchtower.enable=${DOCKERIZALO_PROXY_WATCHTOWER_ENABLED:-true}
      - autoheal=${DOCKERIZALO_PROXY_AUTOHEAL_ENABLED:-true}

  ui:
    image: ghcr.io/undernightcore/dockerizalo-ui:latest
    container_name: ${DOCKERIZALO_UI_CONTAINER_NAME:-ui}
    networks:
      - traefik
    labels:
      - traefik.enable=false

  api:
    image: ghcr.io/undernightcore/dockerizalo:latest
    container_name: ${DOCKERIZALO_API_CONTAINER_NAME:-api}
    volumes:
      - ./etc/dockerizalo/api:/data/dockerizalo
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - traefik
    environment:
      DATABASE_URL: postgresql://${DOCKERIZALO_POSTGRES_USER:-${PG_USER:-admin}}:${DOCKERIZALO_POSTGRES_PASSWORD:-${PG_PASS}}@postgres:5432/dockerizalo?schema=public
      APP_SECRET: hitthekeyboardwithyourheadhere
    depends_on:
      - postgres
    labels:
      - traefik.enable=false

