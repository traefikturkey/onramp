networks:
  traefik:
    external: true
    
# description: A simple, self-hosted app for your checklists and notes
# https://github.com/fccview/rwMarkable
# https://rwmarkable.vercel.app/

services:
  rwmarkable:
    image: ghcr.io/fccview/rwmarkable:${RWMARKABLE_DOCKER_TAG:-latest}
    container_name: ${RWMARKABLE_CONTAINER_NAME:-rwmarkable}
    restart: ${RWMARKABLE_RESTART:-unless-stopped}
    mem_limit: ${RWMARKABLE_MEM_LIMIT:-200g}
    user: "1000:1000"
    networks:
      - traefik
    volumes:
      - ./etc/rwmarkable/data:/app/data
      - ./etc/rwmarkable/config:/app/config:ro
      - ./etc/rwmarkable/cache:/app/.next/cache
      - /etc/localtime:/etc/localtime:ro
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ}
      - NODE_ENV=production
      # Uncomment to enable HTTPS
      # - HTTPS=true

      # --- SSO WITH OIDC (OPTIONAL)
      # - SSO_MODE=oidc
      # - OIDC_ISSUER=<YOUR_SSO_ISSUER>
      # - OIDC_CLIENT_ID=<YOUR_SSO_CLIENT_ID>
      # - APP_URL=https://your-rwmarkable-domain.com # if not set should default to http://localhost:<port>

      # --- ADDITIONAL SSO OPTIONS (OPTIONAL)
      #- OIDC_CLIENT_SECRET=your_client_secret  # Enable confidential client mode with client authentication
      #- SSO_FALLBACK_LOCAL=true  # Allow both SSO and normal login
      #- OIDC_ADMIN_GROUPS=admins # Map provider groups to admin role      
    labels:
      - joyride.host.name=${RWMARKABLE_HOST_NAME:-rwmarkable}.${HOST_DOMAIN}
      - traefik.enable=${RWMARKABLE_TRAEFIK_ENABLED:-true}
      - traefik.http.routers.rwmarkable.entrypoints=websecure
      - traefik.http.routers.rwmarkable.rule=Host(`${RWMARKABLE_HOST_NAME:-rwmarkable}.${HOST_DOMAIN}`)
      #- traefik.http.services.rwmarkable.loadbalancer.server.scheme=https # enable if the service wants to connect over >      
      - traefik.http.services.rwmarkable.loadbalancer.server.port=3000
      - com.centurylinklabs.watchtower.enable=${RWMARKABLE_WATCHTOWER_ENABLED:-true}
      - autoheal=${RWMARKABLE_AUTOHEAL_ENABLED:-true}