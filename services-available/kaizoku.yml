networks:
  traefik:
    external: true

# description: Web-based anime downloader
# https://github.com/oae/kaizoku
# database: postgres
# database_name: kaizoku
# cache: valkey
# cache_db: 0
# Note: kaizoku ignores REDIS_DB environment variable and always uses DB 0

services:
  kaizoku:
    image: ghcr.io/oae/kaizoku:${KAIZOKU_DOCKER_TAG:-v1.6.1} # may need to be updated at some point. latest had issues when I tried.
    container_name: ${KAIZOKU_CONTAINER_NAME:-kaizoku}
    restart: ${KAIZOKU_RESTART:-unless-stopped}
    networks:
      - traefik
    volumes:
      - ${KAIZOKU_MANGA_VOLUME:-./media/manga}:/manga
      - ./etc/kaizoku/config:/config
      - /etc/localtime:/etc/localtime:ro
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ}
      - DATABASE_URL=postgresql://${KAIZOKU_POSTGRES_USER:-${PG_USER:-admin}}:${KAIZOKU_POSTGRES_PASSWORD:-${PG_PASS}}@postgres:5432/kaizoku
      - KAIZOKU_PORT=3000
      - REDIS_HOST=valkey
      - REDIS_PORT=6379
      - REDIS_DB=0  # Note: kaizoku ignores this and always uses DB 0
    labels:
      - joyride.host.name=${KAIZOKU_CONTAINER_NAME:-kaizoku}.${HOST_DOMAIN}
      - traefik.enable=true
      - traefik.http.routers.kaizoku.entrypoints=websecure
      - traefik.http.routers.kaizoku.rule=Host(`${KAIZOKU_CONTAINER_NAME:-kaizoku}.${HOST_DOMAIN}`)
      - traefik.http.routers.kaizoku.middlewares=default-headers@file
      - traefik.http.services.kaizoku.loadbalancer.server.port=3000
      - com.centurylinklabs.watchtower.enable=${KAIZOKU_WATCHTOWER_ENABLED:-true}
      - autoheal=true
