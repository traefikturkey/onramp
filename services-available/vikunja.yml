networks:
  traefik:
    external: true

# description: Task and time management app
# https://vikunja.io/docs/full-docker-example/
# database: mariadb
# database_name: vikunja

services:
  vikunja:
    image: vikunja/vikunja:${VIKUNJA_DOCKER_TAG:-latest}
    container_name: ${VIKUNJA_CONTAINER_NAME:-vikunja}
    networks:
      - traefik
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ}
      - VIKUNJA_SERVICE_PUBLICURL=https://${VIKUNJA_CONTAINER_NAME:-vikunja}.${HOST_DOMAIN}
      - VIKUNJA_DATABASE_HOST=mariadb
      - VIKUNJA_DATABASE_PASSWORD=${VIKUNJA_DATABASE_PASSWORD:-${MARIADB_PASS}}
      - VIKUNJA_DATABASE_TYPE=${VIKUNJA_DATABASE_TYPE:-mysql}
      - VIKUNJA_DATABASE_USER=${VIKUNJA_DATABASE_USER:-${MARIADB_USER:-admin}}
      - VIKUNJA_DATABASE_DATABASE=${VIKUNJA_DATABASE:-vikunja}
      - VIKUNJA_SERVICE_JWTSECRET=${VIKUNJA_SERVICE_JWTSECRET:-<a super secure random secret>}
    restart: ${VIKUNJA_RESTART:-unless-stopped}
    depends_on:
      - mariadb
    labels:
      - joyride.host.name=${VIKUNJA_CONTAINER_NAME:-vikunja}.${HOST_DOMAIN}
      - traefik.enable=true
      - traefik.http.routers.vikunja.entrypoints=websecure
      - traefik.http.routers.vikunja.rule=Host(`${VIKUNJA_CONTAINER_NAME:-vikunja}.${HOST_DOMAIN}`)
      #- traefik.http.services.vikunja.loadbalancer.server.scheme=https # enable if the service wants to connect over https
      - traefik.http.services.vikunja.loadbalancer.server.port=3456
      - com.centurylinklabs.watchtower.enable=${VIKUNJA_WATCHTOWER_ENABLED:-true}
      - autoheal=true

      # Flame dashboard labels

      - flame.type=application # "app" works too
      - flame.name=${VIKUNJA_FLAME_NAME:-vikunja}
      - flame.url=https://${VIKUNJA_CONTAINER_NAME:-vikunja}.${HOST_DOMAIN}
      - flame.icon=${VIKUNJA_FLAME_ICON:-docker}



