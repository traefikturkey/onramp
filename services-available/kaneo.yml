networks:
  traefik:
    external: true

# Description: Self-hosted Project Management
# Documentation: https://kaneo.app/docs/deployments/traefik
# database: postgres
# database_name: kaneo

services:
  kaneo-backend:
    image: ghcr.io/usekaneo/api:${KANEO_BACKEND_DOCKER_TAG:-latest}
    container_name: ${KANEO_BACKEND_CONTAINER_NAME:-kaneo-backend}
    restart: ${KANEO_RESTART:-unless-stopped}
    environment:
      - JWT_ACCESS=${KANEO_JWT_ACCESS:-hotmomsdotcom}
      - DATABASE_URL=postgresql://${KANEO_POSTGRES_USER:-${PG_USER:-admin}}:${KANEO_POSTGRES_PASSWORD:-${PG_PASS}}@postgres:5432/kaneo
      - KANEO_CLIENT_URL=https://${KANEO_HOST_NAME:-kaneo}.${HOST_DOMAIN}
      - CORS_ORIGINS=https://${KANEO_HOST_NAME:-kaneo}.${HOST_DOMAIN}
    networks:
      - traefik
    labels:
      - joyride.host.name=${KANEO_API_HOST_NAME:-kaneo-api}.${HOST_DOMAIN}
      - traefik.enable=${KANEO_TRAEFIK_ENABLED:-true}
      - traefik.http.routers.kaneo-api.entrypoints=websecure
      - traefik.http.routers.kaneo-api.rule=Host(`${KANEO_API_HOST_NAME:-kaneo-api}.${HOST_DOMAIN}`)
      # Uncomment the following line if the service wants to connect over HTTPS
      # - traefik.http.services.kaneo.loadbalancer.server.scheme=https
      - traefik.http.services.kaneo-api.loadbalancer.server.port=1337
      - com.centurylinklabs.watchtower.enable=${KANEO_WATCHTOWER_ENABLED:-true}
      - autoheal=${KANEO_AUTOHEAL_ENABLED:-true}
      - traefik.docker.network=traefik

  kaneo-frontend:
    image: ghcr.io/usekaneo/web:${KANEO_FRONTEND_DOCKER_TAG:-latest}
    container_name: ${KANEO_FRONTEND_CONTAINER_NAME:-kaneo-frontend}
    restart: ${KANEO_RESTART:-unless-stopped}
    environment:
      - KANEO_API_URL=https://${KANEO_API_HOST_NAME:-kaneo-api}.${HOST_DOMAIN}
      - KANEO_CLIENT_URL=https://${KANEO_HOST_NAME:-kaneo}.${HOST_DOMAIN}
    networks:
      - traefik
    depends_on:
      - kaneo-backend
    labels:
      - joyride.host.name=${KANEO_HOST_NAME:-kaneo}.${HOST_DOMAIN}
      - traefik.enable=${KANEO_TRAEFIK_ENABLED:-true}
      - traefik.http.routers.kaneo.entrypoints=websecure
      - traefik.http.routers.kaneo.rule=Host(`${KANEO_HOST_NAME:-kaneo}.${HOST_DOMAIN}`)
      # Uncomment the following line if the service wants to connect over HTTPS
      # - traefik.http.services.kaneo.loadbalancer.server.scheme=https
      - traefik.http.services.kaneo.loadbalancer.server.port=5173
      - com.centurylinklabs.watchtower.enable=${KANEO_WATCHTOWER_ENABLED:-true}
      - autoheal=${KANEO_AUTOHEAL_ENABLED:-true}
      - traefik.docker.network=traefik
